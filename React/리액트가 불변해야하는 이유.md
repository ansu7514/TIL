# 리액트가 불변해야하는 이유
## 🤔 불변성?
#### 불변성이란 상태나 값을 변경하지 않는 것을 의미한다.

**불변성**이 프로그래밍에서 주목 받는 이유는 변경 가능한 상태를 여러 곳에서 공유하게 됨으로써 발생하는 여러 가지 문제를 해결하기 위함이다.  
  
이런 문제는 멀티 스레딩과 같은 동시성 프로그래밍을 사용할 때 많이 발생했는데,  
기존에는 락을 걸어놓고 락이 풀린 상태에만 스레드가 상태에 접근할 수 있도록 허가하는 방식을 주로 사용했다.  
  
```javascript
    let a = 1;
    a = 2;
```
위 코드처럼 변수에 값을 재할당하면 `a`가 참조하고 있는 메모리 값이 변경되는 것이 아니라  
새로운 값인 '2'가 메모리에 새로 저장되고 그 주소에 `a`가 할당된다.  
  
원시 타입 값이 아닌 다른 참조형 값들 (객체, 배열, 함수 등)은 이와 다르게 동작한다.  
```javascript
    const myObj = {
        a: 1
    };

    myObj.a = 2;
```
`myObj`의 내부 프로퍼티의 값을 변경했을 때, `myObj`에서 참조하고 있는 `a`의 값은 변경되지 않고 값이 변경된다.  
단, `a`가 참조하고 있는 '1'의 주소 값은 변경된다.  
  
이처럼 자바스크립트 객체는 **가변**한다.  
리액트에서는 자바스크립트 객체가 가변하기 때문에 문제가 발생한다.
  

## 🔒 리액트 상태 불변성
리액트의 상태가 불변해야 하는 이유는 두 가지가 있다.
1. 값이 변경되었는지 알기 위함
2. 값을 수정할 경우, 이전 상태와 바뀐 상태값이 동일해져서 비교할 수 없기 때문
  
리액트에서는 상태가 변할 경우, **컴포넌트가 리렌더링**된다.  
  
리액트에서 리렌더링할 때, 값 자체가 아니라 참조 값을 비교하므로 참조값이 동일하면, 변경을 감지할 수 없다.  
또한, 값을 수정하면 이전 상태와 바뀐 상태값이 동일해지기 때문에, 이전 상태와 현재 상태를 비교하여 렌더링을 할 수 없게 된다.  
  
불변 객체를 사용하지 않고 객체의 변화를 감지할 수 있지만, 효과적으로 객체의 변화를 감지할 수 있는 가장 좋은 방법은 **불변 객체**를 사용하는 것이다.
  
## 💡 불변하게 만드는 방법
자바스크립트에서 객체를 불변하게 만드는 방법은 크게 3가지 정도 있다.  
`assign` 메서드 사용, `spread` 연산자 사용, 라이브러리 사용이다.

### assign
`Object.assign` 메서드를 사용할 수 있다.
```javascript
    Object.assign({}, myObj, {
        b: 2
    });
```
`Object.assign`은 매개 변수로 전달된 객체의 모든 속성을 첫 번째 매개 변수에 지정된 객체에 복사한다.  
  
### spread 연산자
```javascript
    {
        ...myObj,
        b: 2
    }
```
  
### 라이브러리 사용
위 두 가지 방법을 사용할 경우 얕은 복사만 가능하다.  
그러므로 객체 안의 객체가 있으면 그 안의 객체도 복사해주어야 한다.  
  
하지만 무분별하게 깊은 복사를 사용하는 것은 문제를 야기할 수 있다.  

- 깊은 복사는 성능이 저하될 수 있다.
- 리액트에서 변경되지 않은 객체도 변경되었다고 감지하여 모든 것을 리렌더링할 수 있다.
  
그러므로 변경된 객체만 변경해주는 것이 좋다.  
이를 편하게 하고자 *immer.js*와 같은 라이브러리를 사용하여 쉽게 불변성을 관리할 수 있다.

[*immer.js performance*](https://immerjs.github.io/immer/performance/) 문서를 보면, 변경된 객체만 복사하여 성능을 향상시킬 수 있다고 나와 있다.  
  
## ‼️ 불변성의 단점
- 객체 지향 프로그래밍과 맞지 않는다.
- 불변성 유지를 위해 노력해야 한다.